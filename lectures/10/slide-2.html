<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>10.2 Вразливості смарт-контрактів | Фінансова Безпека</title>
  <link rel="icon" type="image/svg+xml" href="../../img/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/slides.css">
</head>
<body>

  <div class="top-controls">
    <a href="../../lecture.html?id=10">
      <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
      До лекції
    </a>
    <button onclick="toggleTheme()">
      <span id="theme-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg></span>
      <span id="theme-label">Світла</span>
    </button>
  </div>

  <div class="slide-deck">

    <section class="slide active">
      <span class="slide-icon">📜</span>
      <h1>Вразливості смарт-контрактів</h1>
      <p class="subtitle">Лекція 10.2</p>
      <span class="tag tag-blue" style="margin-top: 1rem;">Reentrancy, overflow, access control, аудит</span>
    </section>

    <section class="slide">
      <h1>Чому смарт-контракти вразливі?</h1>
      <div class="icon-list">
        <div class="icon-list-item">
          <span class="il-icon">🔒</span>
          <span class="il-text"><strong>Immutable</strong> — після деплою код НЕ можна змінити (без proxy)</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">👁️</span>
          <span class="il-text"><strong>Public</strong> — код відкритий, зловмисник бачить вразливості</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">💰</span>
          <span class="il-text"><strong>Value</strong> — контракти зберігають мільярди, мотивація для атак максимальна</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">⚡</span>
          <span class="il-text"><strong>Composability</strong> — контракти взаємодіють один з одним, атака на один = каскад</span>
        </div>
      </div>
    </section>

    <section class="slide">
      <h1>Reentrancy Attack</h1>
      <div class="steps">
        <div class="step">
          <div class="step-num">1</div>
          <div class="step-title">Виведення (Withdraw)</div>
          <div class="step-desc">Зловмисник запитує вивід коштів</div>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <div class="step-title">Зворотний виклик (Callback)</div>
          <div class="step-desc">Контракт надсилає ETH → зловмисний fallback</div>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <div class="step-title">Повторний вхід (Re-enter)</div>
          <div class="step-desc">Fallback знову викликає withdraw (баланс не оновлено!)</div>
        </div>
        <div class="step">
          <div class="step-num">4</div>
          <div class="step-title">Злив коштів (Drain)</div>
          <div class="step-desc">Цикл повторюється — весь баланс вичерпано</div>
        </div>
      </div>
      <div class="highlight-box danger" style="margin-top: 1.2rem;">
        <p>The DAO (2016): reentrancy → $60M ETH вкрадено → форк Ethereum на ETH та ETC.</p>
      </div>
    </section>

    <section class="slide">
      <h1>Інші вразливості</h1>
      <div class="card-grid">
        <div class="card accent-red">
          <span class="card-icon">🔢</span>
          <div class="card-title">Переповнення цілого числа (Integer Overflow)</div>
          <div class="card-text">0 - 1 = MAX_UINT256. Solidity 0.8+ має захист, старі — ні</div>
        </div>
        <div class="card accent-orange">
          <span class="card-icon">🔓</span>
          <div class="card-title">Контроль доступу (Access Control)</div>
          <div class="card-text">Критичні функції без onlyOwner = будь-хто може викликати</div>
        </div>
        <div class="card accent-purple">
          <span class="card-icon">⏩</span>
          <div class="card-title">Фронтранінг (Front-running)</div>
          <div class="card-text">Зловмисник бачить mempool → вища gas price → виконується першим</div>
        </div>
        <div class="card accent-blue">
          <span class="card-icon">📡</span>
          <div class="card-title">Маніпуляція оракулом (Oracle Manipulation)</div>
          <div class="card-text">Маніпуляція зовнішньою ціною → дешевий кредит → вилучення коштів</div>
        </div>
      </div>
    </section>

    <section class="slide">
      <h1>Захист смарт-контрактів</h1>
      <div class="icon-list">
        <div class="icon-list-item">
          <span class="il-icon">🔍</span>
          <span class="il-text"><strong>Аудит коду</strong> — мін. 2 незалежні аудити (Trail of Bits, OpenZeppelin)</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">📐</span>
          <span class="il-text"><strong>Formal verification</strong> — математичний доказ коректності (Certora, K Framework)</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">🐛</span>
          <span class="il-text"><strong>Bug bounty</strong> — Immunefi: до $10M за critical vulnerability</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">📚</span>
          <span class="il-text"><strong>OpenZeppelin</strong> — перевірені бібліотеки для ERC-20, ERC-721, access control</span>
        </div>
      </div>
    </section>

    <section class="slide">
      <h1>Reentrancy: The DAO (детально)</h1>
      <div class="steps">
        <div class="step">
          <div class="step-num">1</div>
          <div class="step-title">The DAO</div>
          <div class="step-desc">Інвестиційний фонд на Ethereum, зібрав $150M ETH (2016)</div>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <div class="step-title">splitDAO()</div>
          <div class="step-desc">Функція виведення: спочатку відправляє ETH, потім оновлює баланс</div>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <div class="step-title">Експлуатація (Exploit)</div>
          <div class="step-desc">Fallback → повторний виклик splitDAO() до оновлення балансу: $60M вкрадено</div>
        </div>
        <div class="step">
          <div class="step-num">4</div>
          <div class="step-title">Хард-форк (Hard Fork)</div>
          <div class="step-desc">Ethereum спільнота відкотила транзакції → розкол на ETH та ETC</div>
        </div>
      </div>
      <div class="highlight-box danger" style="margin-top: 1.2rem;">
        <p>Захист: Checks-Effects-Interactions pattern — оновити стан ДО зовнішнього виклику. ReentrancyGuard від OpenZeppelin.</p>
      </div>
    </section>

    <section class="slide">
      <h1>Integer Overflow/Underflow</h1>
      <div class="two-col">
        <div class="col">
          <div class="card accent-red" style="height: 100%;">
            <span class="card-icon">💥</span>
            <div class="card-title">Overflow (до Solidity 0.8)</div>
            <div class="card-text" style="margin-top: 8px; font-size: 0.95rem; line-height: 1.7;">
              uint8 max = 255<br>
              255 + 1 = 0 (переповнення!)<br>
              Атакуючий отримує нескінченні токени<br>
              BEC Token (2018): $900M обнулено
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card accent-orange" style="height: 100%;">
            <span class="card-icon">📉</span>
            <div class="card-title">Underflow (до Solidity 0.8)</div>
            <div class="card-text" style="margin-top: 8px; font-size: 0.95rem; line-height: 1.7;">
              uint256 balance = 0<br>
              0 - 1 = MAX_UINT256<br>
              Баланс стає астрономічним<br>
              Обхід перевірок на достатність коштів
            </div>
          </div>
        </div>
      </div>
      <div class="highlight-box" style="margin-top: 1.2rem;">
        <p>Solidity 0.8+ автоматично перевіряє overflow/underflow (revert). Для старих контрактів: SafeMath від OpenZeppelin.</p>
      </div>
    </section>

    <section class="slide">
      <h1>Інструменти аудиту смарт-контрактів</h1>
      <div class="card-grid">
        <div class="card accent-green">
          <span class="card-icon">🐍</span>
          <div class="card-title">Slither</div>
          <div class="card-text">Статичний аналіз (Trail of Bits). Швидкий, 90+ детекторів, інтеграція з CI/CD. Безкоштовний</div>
        </div>
        <div class="card accent-purple">
          <span class="card-icon">🔮</span>
          <div class="card-title">Mythril</div>
          <div class="card-text">Символічне виконання (ConsenSys). Глибший аналіз, знаходить складні вразливості. Повільніший</div>
        </div>
        <div class="card accent-blue">
          <span class="card-icon">🐰</span>
          <div class="card-title">Echidna</div>
          <div class="card-text">Фаззінг (Trail of Bits). Генерує випадкові вхідні дані, перевіряє інваріанти контракту</div>
        </div>
        <div class="card accent-orange">
          <span class="card-icon">🏢</span>
          <div class="card-title">Ручний аудит</div>
          <div class="card-text">Trail of Bits, OpenZeppelin, Certik. $50K-$500K за аудит. Незамінний для бізнес-логіки</div>
        </div>
      </div>
      <div class="highlight-box" style="margin-top: 1.2rem;">
        <p>Найкращий підхід: автоматичні інструменти (Slither + Mythril) + ручний аудит + bug bounty програма.</p>
      </div>
    </section>

    <section class="slide">
      <h1>Формальна верифікація</h1>
      <div class="icon-list">
        <div class="icon-list-item">
          <span class="il-icon">📐</span>
          <span class="il-text"><strong>Що це?</strong> — математичний доказ, що код відповідає специфікації на 100%</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">🔬</span>
          <span class="il-text"><strong>Certora Prover</strong> — пише правила (інваріанти) та перевіряє їх для ВСІХ можливих станів</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">🧮</span>
          <span class="il-text"><strong>K Framework</strong> — формальна семантика EVM, використовується для верифікації MakerDAO, Uniswap</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">⚖️</span>
          <span class="il-text"><strong>Обмеження</strong> — дорого ($100K+), довго (місяці), верифікує лише специфіковані властивості</span>
        </div>
      </div>
      <div class="highlight-box" style="margin-top: 1.2rem;">
        <p>Аудит знаходить відомі патерни вразливостей. Формальна верифікація доводить відсутність цілих класів помилок.</p>
      </div>
    </section>

    <section class="slide">
      <span class="slide-icon">🛡️</span>
      <h1>Ключові висновки</h1>
      <div class="icon-list">
        <div class="icon-list-item">
          <span class="il-icon">1️⃣</span>
          <span class="il-text"><strong>Reentrancy</strong> — #1 вразливість, Checks-Effects-Interactions pattern</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">2️⃣</span>
          <span class="il-text"><strong>Immutable code</strong> — помилку після деплою не виправити без proxy</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">3️⃣</span>
          <span class="il-text"><strong>Аудит</strong> — мінімум 2 аудити + formal verification для DeFi</span>
        </div>
        <div class="icon-list-item">
          <span class="il-icon">4️⃣</span>
          <span class="il-text"><strong>OpenZeppelin</strong> — використовуйте перевірені бібліотеки, не пишіть з нуля</span>
        </div>
      </div>
    </section>

  </div>

  <div class="slide-counter" id="counter"></div>
  <div class="slide-progress" id="progress"></div>

  <div class="controls">
    <button onclick="prev()">&#8592;</button>
    <button onclick="next()">&#8594;</button>
  </div>

  <script src="../../js/slides.js"></script>

</body>
</html>

