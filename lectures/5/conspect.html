<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Конспект лекції 5: Серверні вразливості та безпека баз даних фінансових систем.">
  <meta name="author" content="Кафедра ТЕІБ, Ужгородський національний університет">
  <meta name="theme-color" content="#0ea5e9">
  <title>Конспект: Лекція 5 — Фінансова Безпека</title>
  <link rel="icon" type="image/svg+xml" href="../../img/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/style.css">
  <script>if(localStorage.getItem('theme')==='dark')document.documentElement.classList.add('dark')</script>
</head>
<body>

  <aside>
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          <path d="M9 12l2 2 4-4"/>
        </svg>
      </div>
      <div class="logo-text">
        Фінансова<br>Безпека
        <span>онлайн-курс</span>
      </div>
    </div>

    <nav aria-label="Головна навігація">
      <a href="../../index.html" class="active">
        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg></span>
        Лекції
      </a>
      <a href="../../practicals.html">
        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></span>
        Практичні
      </a>
      <a href="../../tests.html">
        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></span>
        Тести
      </a>
      <a href="../../materials.html">
        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg></span>
        Матеріали
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Перемкнути тему">
        <svg id="theme-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        <span id="theme-label">Темна тема</span>
      </button>
    </div>
  </aside>

  <main>
    <div class="lecture-nav-top">
      <a href="../../lecture.html?id=5" class="back-link">&larr; Назад до лекції 5</a>
      <span class="lecture-badge">Конспект лекції 5</span>
    </div>

    <article class="lecture-content">
      <h1>Серверні вразливості та бази даних</h1>
      <div class="lecture-info">
        <span>⏱ 2 год</span>
        <span class="badge badge-new">Конспект</span>
      </div>

      <!-- Section 5.1 -->
      <section>
        <h2>5.1 SQL-ін'єкції у фінансових системах</h2>

        <p>SQL-ін'єкція (SQLi) — це вразливість, при якій зловмисник впроваджує шкідливий SQL-код у запити до бази даних через неналежно оброблені вхідні дані. Незважаючи на те, що SQLi відома понад 25 років, вона залишається однією з найнебезпечніших вразливостей: за даними OWASP, ін'єкції стабільно входять до Top 3. У фінансовому секторі одна SQL-ін'єкція може дати доступ до мільйонів записів клієнтів, рахунків та транзакцій.</p>

        <p><strong>Типи SQL-ін'єкцій:</strong></p>
        <ul>
          <li><strong>Classic (In-band) SQLi</strong> — зловмисник отримує результат ін'єкції безпосередньо у відповіді додатку. Наприклад, ін'єкція <code>' OR 1=1 --</code> у поле логіну обходить автентифікацію, а <code>UNION SELECT</code> дозволяє витягувати дані з інших таблиць.</li>
          <li><strong>Blind SQLi</strong> — додаток не показує результати запиту, але зловмисник може визначити відповідь (true/false) за різницею у поведінці: різний текст помилки, наявність або відсутність елементів на сторінці. Boolean-based: <code>' AND 1=1 --</code> (сторінка нормальна) vs <code>' AND 1=2 --</code> (сторінка інша).</li>
          <li><strong>Time-based Blind SQLi</strong> — коли відповідь не відрізняється, зловмисник використовує затримку: <code>'; IF (SELECT user) = 'admin' WAITFOR DELAY '0:0:5' --</code>. Якщо відповідь прийшла через 5 секунд — умова істинна.</li>
          <li><strong>Out-of-band SQLi</strong> — дані передаються через альтернативний канал: DNS-запити, HTTP-запити з бази до зовнішнього сервера (xp_cmdshell, UTL_HTTP).</li>
        </ul>

        <p><strong>Second-Order SQL Injection</strong> — особливо підступний варіант, де шкідливі дані зберігаються у базі у чистому вигляді (наприклад, ім'я користувача <code>admin'--</code>), а ін'єкція спрацьовує пізніше, коли ці дані використовуються в іншому SQL-запиті без параметризації. Небезпечний для фінансових систем, де дані проходять через кілька мікросервісів.</p>

        <p><strong>ORM Injection.</strong> Використання ORM (Hibernate, SQLAlchemy, Sequelize) не гарантує захист від ін'єкцій. Raw queries, HQL/JPQL ін'єкції, некоректне використання query builders — все це створює вектори атак. Приклад: <code>User.where("name = '#{params[:name]}'")</code> в Ruby on Rails — класична ін'єкція через ORM.</p>

        <p><strong>Кейс з фінансового сектору:</strong> у 2023 році дослідники виявили SQLi-вразливість у платіжному процесорі, що обслуговував тисячі торговців. Через ін'єкцію в API endpoint для пошуку транзакцій зловмисник міг отримати повні дані кредитних карток (PAN, expiry, CVV) мільйонів клієнтів. Вразливість існувала через конкатенацію рядків у legacy-коді, який не було оновлено при міграції на нову платформу.</p>
      </section>

      <!-- Section 5.2 -->
      <section>
        <h2>5.2 Серверні ін'єкції та SSRF</h2>

        <p>Окрім SQL-ін'єкцій, існує ціле сімейство серверних вразливостей, кожна з яких може призвести до компрометації фінансової інфраструктури.</p>

        <p><strong>Command Injection (OS Command Injection)</strong> — впровадження команд операційної системи через вхідні дані додатку. Якщо сервер виконує системні команди з використанням даних користувача без належної санітизації, зловмисник може виконати довільний код.</p>
        <ul>
          <li>Приклад: PDF-генератор рахунків, що використовує <code>wkhtmltopdf</code> або <code>pdftk</code> з параметрами з user input. Ін'єкція: <code>invoice.pdf; cat /etc/passwd</code>.</li>
          <li>Фінансовий контекст: генерація виписок, звітів, сертифікатів — всюди, де сервер викликає зовнішні утиліти з даними клієнта.</li>
          <li>Захист: ніколи не використовувати shell execution з user input; використовувати бібліотечні API замість CLI; якщо неминуче — строга whitelist-валідація.</li>
        </ul>

        <p><strong>Server-Side Request Forgery (SSRF)</strong> — вразливість, при якій зловмисник змушує сервер надсилати запити до внутрішніх ресурсів, які недоступні ззовні. SSRF увійшла до OWASP Top 10 у 2021 році та є критичною загрозою для хмарної інфраструктури.</p>
        <ul>
          <li><strong>Атака на cloud metadata:</strong> запит до <code>http://169.254.169.254/latest/meta-data/</code> з AWS EC2 дає доступ до IAM credentials, secret keys — повний доступ до хмарної інфраструктури банку.</li>
          <li><strong>Сканування внутрішньої мережі:</strong> через SSRF зловмисник може виявити внутрішні сервіси банку (Redis, Elasticsearch, адміністративні панелі), які не мають автентифікації, бо «не виставлені в інтернет».</li>
          <li><strong>Capital One breach (2019):</strong> через SSRF у WAF зловмисник отримав IAM credentials з AWS metadata та завантажив дані 106 мільйонів клієнтів. Збитки: $80 мільйонів штрафів.</li>
          <li>Захист: блокування запитів до приватних IP-діапазонів, whitelist дозволених доменів, IMDSv2 для AWS (вимагає токен для metadata).</li>
        </ul>

        <p><strong>XML External Entity (XXE)</strong> — вразливість XML-парсерів, що дозволяє читати файли сервера, виконувати SSRF та в деяких випадках — Remote Code Execution. Актуально для фінансового сектору, де XML широко використовується: SWIFT-повідомлення, ISO 20022, SOAP API, банківські звіти.</p>
        <ul>
          <li>Зловмисник додає зовнішню сутність (external entity) у XML-документ, що посилається на файл або URL.</li>
          <li>Приклад: XXE у парсері SWIFT XML-повідомлень може дати доступ до конфігурацій, ключів та інших файлів серверу.</li>
          <li>Захист: вимкнути DTD processing та external entities у XML-парсері, використовувати JSON замість XML де можливо.</li>
        </ul>

        <p><strong>Server-Side Template Injection (SSTI)</strong> — ін'єкція в серверні шаблонізатори (Jinja2, Twig, Freemarker, Thymeleaf). Якщо дані користувача потрапляють у шаблон без обробки, зловмисник може виконати довільний код на сервері. Приклад: email-шаблони для фінансових повідомлень, де ім'я клієнта вставляється безпосередньо в Jinja2-шаблон.</p>
      </section>

      <!-- Section 5.3 -->
      <section>
        <h2>5.3 Безпека баз даних</h2>

        <p>Бази даних є найціннішим активом фінансових організацій — вони містять персональні дані клієнтів, номери рахунків, історію транзакцій, кредитні скоринги та іншу конфіденційну інформацію. Комплексна безпека баз даних включає шифрування, розмежування доступу, аудит та захист резервних копій.</p>

        <p><strong>Шифрування даних:</strong></p>
        <ul>
          <li><strong>Encryption at Rest (TDE — Transparent Data Encryption)</strong> — шифрування файлів бази даних на диску. Захищає від крадіжки фізичних носіїв або файлів бази. Oracle TDE, SQL Server TDE, PostgreSQL pgcrypto. PCI DSS вимагає шифрування PAN (номерів карток) at rest.</li>
          <li><strong>Encryption in Transit</strong> — TLS/SSL для з'єднань між додатком та базою даних. За замовчуванням багато баз передають дані у відкритому вигляді (MySQL, PostgreSQL без конфігурації). Обов'язкове для фінансових систем.</li>
          <li><strong>Column-level Encryption</strong> — шифрування окремих стовпців з чутливими даними (PAN, CVV, SSN). Навіть DBA з доступом до таблиці не бачить розшифровані дані без відповідного ключа.</li>
          <li><strong>Application-level Encryption</strong> — дані шифруються до збереження в базі на рівні додатку. Найвищий рівень захисту: навіть компрометація бази не дає доступ до даних. Використовується для найкритичніших даних (токени карток, криптографічні ключі).</li>
        </ul>

        <p><strong>Розмежування доступу до бази даних:</strong></p>
        <ul>
          <li><strong>Принцип найменших привілеїв:</strong> кожен мікросервіс має окремий обліковий запис бази з мінімально необхідними правами. Сервіс аналітики — лише SELECT, сервіс платежів — SELECT/INSERT/UPDATE на конкретних таблицях.</li>
          <li><strong>Row-Level Security (RLS)</strong> — обмеження доступу на рівні рядків. Менеджер відділення бачить лише клієнтів свого відділення. PostgreSQL та SQL Server підтримують RLS нативно.</li>
          <li><strong>Dynamic Data Masking</strong> — маскування чутливих даних для непривілейованих користувачів. Оператор call-центру бачить номер картки як **** **** **** 1234, а не повний PAN.</li>
          <li><strong>Заборона прямого доступу:</strong> розробники та адміністратори не повинні мати прямий доступ до production бази. Усі запити — через затверджені інструменти з аудитом (DBeaver з PAM-інтеграцією, QuerySurge).</li>
        </ul>

        <p><strong>Database Activity Monitoring (DAM)</strong> — моніторинг та аудит усіх запитів до бази даних у реальному часі. Виявляє аномальні запити: SELECT на всю таблицю клієнтів, масовий експорт даних, запити в неробочий час, DDL-зміни. Рішення: IBM Guardium, Imperva SecureSphere, Oracle Audit Vault.</p>

        <p><strong>Безпека резервних копій:</strong> backup бази — це повна копія всіх даних. Вимоги: шифрування backup (AES-256), розмежування доступу до backup storage, тестування відновлення, зберігання в окремій локації (geographic separation), дотримання retention policy (не зберігати довше необхідного). Кейс: у 2020 році незашифрований backup PostgreSQL банку був випадково завантажений у публічний S3-bucket, розкривши дані 500 000 клієнтів.</p>
      </section>

      <!-- Section 5.4 -->
      <section>
        <h2>5.4 Комплексний захист серверної частини</h2>

        <p>Захист серверної частини фінансового додатку вимагає комплексного підходу: від безпечного коду до правильної конфігурації інфраструктури.</p>

        <p><strong>Параметризовані запити (Prepared Statements)</strong> — основний і найнадійніший захист від SQL-ін'єкцій. Запит та дані передаються окремо, тому дані користувача ніколи не інтерпретуються як SQL-код:</p>
        <ul>
          <li>SQL-движок компілює шаблон запиту з плейсхолдерами (<code>?</code> або <code>$1</code>), а значення підставляються пізніше як дані, не як код.</li>
          <li>Підтримується усіма сучасними мовами та фреймворками: PDO (PHP), PreparedStatement (Java), parameterized queries (Python/psycopg2), pg (Node.js).</li>
          <li><strong>Правило:</strong> 100% запитів до бази повинні використовувати параметризацію. Жодних виключень, навіть для «внутрішніх» або «адміністративних» запитів.</li>
        </ul>

        <p><strong>ORM Best Practices:</strong></p>
        <ul>
          <li>Використовувати query builders та ORM-методи замість raw SQL.</li>
          <li>Уникати string interpolation у запитах навіть усередині ORM.</li>
          <li>Обережно з dynamic queries: <code>Model.where(params[:filter])</code> може бути вразливим до mass assignment.</li>
          <li>Регулярно оновлювати ORM до останніх версій — вразливості знаходять і в Hibernate, і в ActiveRecord.</li>
        </ul>

        <p><strong>Web Application Firewall (WAF)</strong> — фільтрація HTTP-трафіку для блокування типових атак:</p>
        <ul>
          <li><strong>Signature-based detection</strong> — виявлення відомих патернів атак (UNION SELECT, <code>&lt;script&gt;</code>, <code>../../../etc/passwd</code>).</li>
          <li><strong>Anomaly detection</strong> — визначення аномальної поведінки: незвично довгі параметри, нетипові символи, підвищена частота запитів.</li>
          <li><strong>Virtual patching</strong> — блокування експлуатації відомої вразливості на рівні WAF до виправлення коду. Критично для legacy-систем банків.</li>
          <li>Рішення: AWS WAF, Cloudflare WAF, ModSecurity (open-source), F5 Advanced WAF.</li>
          <li><strong>Обмеження:</strong> WAF — це додатковий шар, а не заміна безпечного коду. Обходи WAF через encoding, fragmentation, alternative syntax — поширена практика.</li>
        </ul>

        <p><strong>Input Validation</strong> — перевірка вхідних даних на відповідність очікуваному формату:</p>
        <ul>
          <li><strong>Whitelist validation</strong> — дозволяти лише відомі безпечні значення. IBAN — строгий формат (UA + 27 цифр), сума — число з 2 десятковими знаками, валюта — enum [UAH, USD, EUR].</li>
          <li><strong>Type checking</strong> — перевірка типів на рівні API-схеми (OpenAPI/JSON Schema). Account_id — integer, не string.</li>
          <li><strong>Length limits</strong> — обмеження довжини полів. Коментар до платежу — max 140 символів, ім'я — max 100.</li>
          <li><strong>Business logic validation</strong> — перевірка бізнес-правил: сума переказу > 0, відправник ≠ отримувач, достатній баланс.</li>
        </ul>

        <p><strong>Database Hardening</strong> — захищена конфігурація серверів баз даних: зміна default credentials, вимкнення непотрібних функцій (xp_cmdshell, LOAD_FILE), мінімальний набір привілеїв для service accounts, мережева ізоляція бази (не виставляти в інтернет), регулярне оновлення та патчинг, CIS Benchmarks для конкретних СУБД.</p>
      </section>

      <!-- Summary -->
      <section>
        <h2>Підсумок</h2>
        <p>У цій лекції ми розглянули серверні вразливості та безпеку баз даних — критичні компоненти захисту фінансових систем. SQL-ін'єкції у всіх формах (classic, blind, time-based, second-order) залишаються одними з найнебезпечніших вразливостей, а SSRF, XXE та Command Injection створюють додаткові вектори атак на серверну інфраструктуру.</p>
        <p>Безпека баз даних у фінансовому секторі вимагає багаторівневого підходу: шифрування (at rest, in transit, column-level), строге розмежування доступу (RLS, dynamic masking), безперервний моніторинг (DAM) та захист backup. Комплексний захист серверу базується на параметризованих запитах, WAF, input validation та database hardening.</p>
        <p><strong>У наступній лекції</strong> ми розглянемо стандартизацію OWASP та методологію аудиту безпеки: OWASP Top 10, ASVS, Testing Guide та практичний підхід до оцінки вразливостей фінансових систем.</p>
      </section>
    </article>

    <div class="lecture-nav-bottom">
      <a href="../../lecture.html?id=5" class="nav-btn">&larr; Назад до лекції</a>
      <span></span>
    </div>

    <footer></footer>
  </main>

  <script src="../../js/main.js"></script>

</body>
</html>
